<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  



  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar/portrait.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar/portrait.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar/portrait.png?v=5.1.4">


  <link rel="mask-icon" href="/images/avatar/portrait.png?v=5.1.4" color="#222">





  <meta name="keywords" content="JVM,垃圾回收," />





  <link rel="alternate" href="/atom.xml" title="Ennis Wu" type="application/atom+xml" />






<meta name="description" content="原文 JVM垃圾回收  聊聊Java的GC机制  深入Java虚拟机之 – 总结面试篇   JVM 内存区域  方法区  存储已被虚拟机加载的类信息、常量、静态变量等   堆  JVM 管理的内存中最大的一块  存放对象实例  GC 主要作用的区域    虚拟机栈：  局部变量表、操作数栈  描述 Java 方法执行的内存模型    本地方法栈  与虚拟机栈类似，为 native 方法提供服务">
<meta name="keywords" content="JVM,垃圾回收">
<meta property="og:type" content="article">
<meta property="og:title" content="「笔记」JVM 内存区域与垃圾回收">
<meta property="og:url" content="http://blog.ennis.info/2020/04/26/JVM内存区域与垃圾回收/index.html">
<meta property="og:site_name" content="Ennis Wu">
<meta property="og:description" content="原文 JVM垃圾回收  聊聊Java的GC机制  深入Java虚拟机之 – 总结面试篇   JVM 内存区域  方法区  存储已被虚拟机加载的类信息、常量、静态变量等   堆  JVM 管理的内存中最大的一块  存放对象实例  GC 主要作用的区域    虚拟机栈：  局部变量表、操作数栈  描述 Java 方法执行的内存模型    本地方法栈  与虚拟机栈类似，为 native 方法提供服务">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.ennis.info/images/posts/JVM/jvm_memory.jpg">
<meta property="og:image" content="http://blog.ennis.info/images/posts/JVM/jvm_memory_heap.png">
<meta property="og:image" content="http://blog.ennis.info/images/posts/JVM/gc_mark_sweep.jpg">
<meta property="og:image" content="http://blog.ennis.info/images/posts/JVM/gc_copying.jpg">
<meta property="og:image" content="http://blog.ennis.info/images/posts/JVM/gc_mark_compact.jpg">
<meta property="og:updated_time" content="2020-05-18T17:51:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="「笔记」JVM 内存区域与垃圾回收">
<meta name="twitter:description" content="原文 JVM垃圾回收  聊聊Java的GC机制  深入Java虚拟机之 – 总结面试篇   JVM 内存区域  方法区  存储已被虚拟机加载的类信息、常量、静态变量等   堆  JVM 管理的内存中最大的一块  存放对象实例  GC 主要作用的区域    虚拟机栈：  局部变量表、操作数栈  描述 Java 方法执行的内存模型    本地方法栈  与虚拟机栈类似，为 native 方法提供服务">
<meta name="twitter:image" content="http://blog.ennis.info/images/posts/JVM/jvm_memory.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.ennis.info/2020/04/26/JVM内存区域与垃圾回收/"/>





  <title>「笔记」JVM 内存区域与垃圾回收 | Ennis Wu</title>
  








  <script src="/lib/photo/photoswipe.min.js"></script>
  <script src="/lib/photo/photoswipe-ui-default.min.js"></script>
  <script src="/lib/public/jquery-3.3.1.min.js"></script>
  <link href="/lib/moment/jquery.fancybox.min.css" rel="stylesheet">
  <script src="/lib/moment/jquery.fancybox.min.js"></script>
  <script src="/lib/moment/moment.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ennis Wu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ARTPOP = artistic revolution through the potential of pop.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            日志
          </a>
        </li>
      
        
        <li class="menu-item menu-item-瞬间">
          <a href="/moments/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bolt"></i> <br />
            
            瞬间
          </a>
        </li>
      
        
        <li class="menu-item menu-item-相册">
          <a href="/photos/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-image"></i> <br />
            
            相册
          </a>
        </li>
      
        
        <li class="menu-item menu-item-足迹">
          <a href="/footprints/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-map-marker"></i> <br />
            
            足迹
          </a>
        </li>
      
        
        <li class="menu-item menu-item-影视">
          <a href="/movies/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-film"></i> <br />
            
            影视
          </a>
        </li>
      
        
        <li class="menu-item menu-item-留言">
          <a href="/comments/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comments"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>
    <script>
      let images = [
         'header0.jpg',
         'header1.jpg',
         'header2.png'
      ];
      let image = images[Math.floor(Math.random() * images.length)];
      window.document.getElementById('header').style.cssText 
      = 'background: url(/images/avatar/' 
      + image
      + '); no-repeat; background-size: auto 100%;';
    </script>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.ennis.info/2020/04/26/JVM内存区域与垃圾回收/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ennis L.M. Wu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/portrait.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ennis Wu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">「笔记」JVM 内存区域与垃圾回收</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-26T14:56:32+08:00">
                2020-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h1><ul>
<li><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.md" target="_blank" rel="noopener">JVM垃圾回收</a></p>
</li>
<li><p><a href="https://juejin.im/post/5df2ec71f265da33d7442433" target="_blank" rel="noopener">聊聊Java的GC机制</a></p>
</li>
<li><p><a href="https://juejin.im/post/5ccfa05af265da039f0f243b" target="_blank" rel="noopener">深入Java虚拟机之 – 总结面试篇</a></p>
</li>
</ul>
<h1 id="JVM-内存区域"><a href="#JVM-内存区域" class="headerlink" title="JVM 内存区域"></a>JVM 内存区域</h1><p><img src="/images/posts/JVM/jvm_memory.jpg" alt=""></p>
<ul>
<li><p>方法区</p>
<ul>
<li>存储已被虚拟机加载的类信息、常量、静态变量等</li>
</ul>
</li>
<li><p>堆</p>
<ul>
<li><p>JVM 管理的内存中最大的一块</p>
</li>
<li><p>存放对象实例</p>
</li>
<li><p>GC 主要作用的区域</p>
</li>
</ul>
</li>
<li><p>虚拟机栈：</p>
<ul>
<li><p>局部变量表、操作数栈</p>
</li>
<li><p>描述 Java 方法执行的内存模型</p>
</li>
</ul>
</li>
<li><p>本地方法栈</p>
<ul>
<li>与虚拟机栈类似，为 native 方法提供服务</li>
</ul>
</li>
<li><p>程序计数器</p>
<ul>
<li><p>记录当前线程执行的方法执行到了第几行</p>
</li>
<li><p>线程正在执行的是 Java 方法，计数器记录正在执行的虚拟机字节码指令的地址</p>
</li>
<li><p>线程正在执行的是 native 方法，这个计数器值则为空（Undefined）</p>
</li>
</ul>
</li>
<li><p>JDK 1.7 之前常量池在方法区，JDK 1.7 之后常量池在堆</p>
</li>
</ul>
<h2 id="堆的划分"><a href="#堆的划分" class="headerlink" title="堆的划分"></a>堆的划分</h2><p><img src="/images/posts/JVM/jvm_memory_heap.png" alt=""></p>
<ul>
<li>JDK 1.8 之前</li>
</ul>
<p>堆 = 新生代 + 老年代 + 永久代</p>
<p>新生代 = Eden 区 + Survivor from 区 + Survivor to 区</p>
<ul>
<li>JDK 1.8 之后</li>
</ul>
<p>堆 = 新生代 + 老年代 + 元空间（使用物理内存）</p>
<h1 id="GC-的分类"><a href="#GC-的分类" class="headerlink" title="GC 的分类"></a>GC 的分类</h1><ul>
<li><p>新生代 GC（Minor GC）</p>
<ul>
<li><p>发生新生代的的 GC</p>
</li>
<li><p>Minor GC 非常频繁</p>
</li>
<li><p>回收速度一般比较快</p>
</li>
</ul>
</li>
<li><p>老年代 GC（Major GC/Full GC）</p>
<ul>
<li><p>发生在老年代的 GC</p>
</li>
<li><p>出现 Major GC 通常会伴随至少一次的 Minor G</p>
</li>
<li><p>Major GC 速度一般比 Minor GC 慢 10 倍以上</p>
</li>
</ul>
</li>
</ul>
<h1 id="内存分配规则"><a href="#内存分配规则" class="headerlink" title="内存分配规则"></a>内存分配规则</h1><ul>
<li><p>对象优先在 Eden 区分配</p>
</li>
<li><p>Eden 区没有足够空间进行分配时，虚拟机将发起一次 Minor GC</p>
</li>
<li><p>大对象直接进入老年代</p>
</li>
</ul>
<p>大对象指需要大量连续内存空间的对象（比如：字符串、数组）。</p>
<p>为了避免为大对象分配内存时由于分配担保机制带来的复制而降低效率。</p>
<ul>
<li><p>长期存活的对象将进入老年代</p>
</li>
<li><p>动态对象年龄判定</p>
</li>
</ul>
<p>如果 Survivor 空间中相同年龄所有对象大小的总和大于 Survivor 空间的一半，年龄大于或等于该年龄的对象就可以直接进入老年代。</p>
<h1 id="GC-Roots-是什么"><a href="#GC-Roots-是什么" class="headerlink" title="GC Roots 是什么"></a>GC Roots 是什么</h1><blockquote>
<p><a href="https://help.eclipse.org/2019-09/index.jsp?topic=%2Forg.eclipse.mat.ui.help%2Fconcepts%2Fgcroots.html&amp;resultof=%22%67%61%72%62%61%67%65%22%20%22%67%61%72%62%61%67%22%20" target="_blank" rel="noopener">Garbage Collection Roots</a><br>A garbage collection root is an object that is accessible from outside the heap. The following reasons make an object a GC root:<br><strong>System Class</strong><br>Class loaded by bootstrap/system class loader. For example, everything from the rt.jar like java.util.* .<br><strong>JNI Local</strong><br>Local variable in native code, such as user defined JNI code or JVM internal code.<br><strong>JNI Global</strong><br>Global variable in native code, such as user defined JNI code or JVM internal code.<br><strong>Thread Block</strong><br>Object referred to from a currently active thread block.<br><strong>Thread</strong><br>A started, but not stopped, thread.<br><strong>Busy Monitor</strong><br>Everything that has called wait() or notify() or that is synchronized. For example, by calling synchronized(Object) or by entering a synchronized method. Static method means class, non-static method means object.<br><strong>Java Local</strong><br>Local variable. For example, input parameters or locally created objects of methods that are still in the stack of a thread.<br><strong>Native Stack</strong><br>In or out parameters in native code, such as user defined JNI code or JVM internal code. This is often the case as many methods have native parts and the objects handled as method parameters become GC roots. For example, parameters used for file/network I/O methods or reflection.<br><strong>Finalizable</strong><br>An object which is in a queue awaiting its finalizer to be run.<br><strong>Unfinalized</strong><br>An object which has a finalize method, but has not been finalized and is not yet on the finalizer queue.<br><strong>Unreachable</strong><br>An object which is unreachable from any other root, but has been marked as a root by MAT to retain objects which otherwise would not be included in the analysis.<br><strong>Java Stack Frame</strong><br>A Java stack frame, holding local variables. Only generated when the dump is parsed with the preference set to treat Java stack frames as objects.<br><strong>Unknown</strong><br>An object of unknown root type. Some dumps, such as IBM Portable Heap Dump files, do not have root information. For these dumps the MAT parser marks objects which are have no inbound references or are unreachable from any other root as roots of this type. This ensures that MAT retains all the objects in the dump.</p>
</blockquote>
<ul>
<li><p>由系统类加载器（system class loader）加载的对象</p>
</li>
<li><p>活着的线程，包含处于等待或阻塞的线程</p>
</li>
<li><p>当前被调用的方法（Java 方法，native 方法）的一些参数和局部变量</p>
</li>
<li><p>方法区中静态变量，常量引用的对象</p>
</li>
<li><p>Held by JVM</p>
</li>
</ul>
<p>JVM 由于特殊目的为 GC 保留的对象，实际与 JVM 的实现有关。</p>
<p>可能已知的一些类型是：系统类加载器、一些 JVM 知道的重要的异常类、一些用于处理异常的预分配对象以及一些自定义的类加载器等。</p>
<h1 id="常量池的-gc"><a href="#常量池的-gc" class="headerlink" title="常量池的 gc"></a>常量池的 gc</h1><ul>
<li>该常量没有任何引用</li>
</ul>
<h1 id="方法区的-gc"><a href="#方法区的-gc" class="headerlink" title="方法区的 gc"></a>方法区的 gc</h1><ul>
<li><p>该类不存在任何对象</p>
</li>
<li><p>该类 <code>GlassLoader</code> 已被回收</p>
</li>
<li><p><code>java.lang.Class</code> 对象不存在任何引用，任何地方无反射该类</p>
</li>
</ul>
<h1 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h1><ul>
<li><p>Mark-Sweep（标记-清除）算法</p>
</li>
<li><p>Copying（复制）算法</p>
<ul>
<li><p>1:1 复制</p>
</li>
<li><p>8:1 复制</p>
</li>
</ul>
</li>
<li><p>Mark-Compact（标记-整理）算法</p>
</li>
<li><p>Generational Collection（分代收集）算法</p>
</li>
</ul>
<h2 id="标记-清除算法"><a href="#标记-清除算法" class="headerlink" title="标记-清除算法"></a>标记-清除算法</h2><p><img src="/images/posts/JVM/gc_mark_sweep.jpg" alt=""></p>
<ol>
<li><p>标记所有需要回收的对象</p>
</li>
<li><p>统一回收所有被标记的对象</p>
</li>
</ol>
<ul>
<li>会产生大量不连续的碎片</li>
</ul>
<h2 id="复制算法（1-1）"><a href="#复制算法（1-1）" class="headerlink" title="复制算法（1:1）"></a>复制算法（1:1）</h2><p><img src="/images/posts/JVM/gc_copying.jpg" alt=""></p>
<ol>
<li><p>将内存分为两块</p>
</li>
<li><p>一块使用完后存活的对象复制到另一块</p>
</li>
<li><p>把已使用的空间清空</p>
</li>
</ol>
<h2 id="标记-整理算法"><a href="#标记-整理算法" class="headerlink" title="标记-整理算法"></a>标记-整理算法</h2><p><img src="/images/posts/JVM/gc_mark_compact.jpg" alt=""></p>
<ul>
<li>针对老年代</li>
</ul>
<ol>
<li><p>标记所有需要回收的对象</p>
</li>
<li><p>将存活的对象移到一端</p>
</li>
<li><p>清理端边界以外的内存</p>
</li>
</ol>
<h2 id="分代收集算法"><a href="#分代收集算法" class="headerlink" title="分代收集算法"></a>分代收集算法</h2><ul>
<li><p>新生代使用复制算法</p>
</li>
<li><p>老年代使用标记-清除算法或标记-整理算法</p>
</li>
</ul>
<h3 id="复制算法（8-1）"><a href="#复制算法（8-1）" class="headerlink" title="复制算法（8:1）"></a>复制算法（8:1）</h3><ul>
<li>新生代内存分配比例： Eden 区 : Survivor from 区 : Survivor to 区 = 8 : 1 : 1</li>
</ul>
<ol>
<li><p>先使用 Eden 区和 from 区</p>
</li>
<li><p>GC 时将存活的对象复制到 to 区</p>
</li>
<li><p>清理 Eden 区和 to 区</p>
</li>
</ol>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果你喜欢这篇文章的话。。。能给我一个小红包吗，爱你呦~(*´∀`)~♥</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/reward/reward_wechatpay.jpg" alt="Ennis L.M. Wu 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/reward/reward_alipay.jpg" alt="Ennis L.M. Wu 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JVM/" rel="tag"># JVM</a>
          
            <a href="/tags/垃圾回收/" rel="tag"># 垃圾回收</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/17/转-Activity相关问题/" rel="next" title="「转载」Activity 的相关问题">
                <i class="fa fa-chevron-left"></i> 「转载」Activity 的相关问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/16/HTTP中GET与POST的区别/" rel="prev" title="「转载」HTTP 中 GET 与 POST 的区别">
                「转载」HTTP 中 GET 与 POST 的区别 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar/portrait.png"
                alt="Ennis L.M. Wu" />
            
              <p class="site-author-name" itemprop="name">Ennis L.M. Wu</p>
              <p class="site-description motion-element" itemprop="description">We could, we could belong togeter, <br>ARTPOP.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:ennis.wu@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/EnnisWu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#原文"><span class="nav-number">1.</span> <span class="nav-text">原文</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JVM-内存区域"><span class="nav-number">2.</span> <span class="nav-text">JVM 内存区域</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#堆的划分"><span class="nav-number">2.1.</span> <span class="nav-text">堆的划分</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GC-的分类"><span class="nav-number">3.</span> <span class="nav-text">GC 的分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#内存分配规则"><span class="nav-number">4.</span> <span class="nav-text">内存分配规则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GC-Roots-是什么"><span class="nav-number">5.</span> <span class="nav-text">GC Roots 是什么</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常量池的-gc"><span class="nav-number">6.</span> <span class="nav-text">常量池的 gc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#方法区的-gc"><span class="nav-number">7.</span> <span class="nav-text">方法区的 gc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#垃圾回收算法"><span class="nav-number">8.</span> <span class="nav-text">垃圾回收算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#标记-清除算法"><span class="nav-number">8.1.</span> <span class="nav-text">标记-清除算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#复制算法（1-1）"><span class="nav-number">8.2.</span> <span class="nav-text">复制算法（1:1）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标记-整理算法"><span class="nav-number">8.3.</span> <span class="nav-text">标记-整理算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分代收集算法"><span class="nav-number">8.4.</span> <span class="nav-text">分代收集算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#复制算法（8-1）"><span class="nav-number">8.4.1.</span> <span class="nav-text">复制算法（8:1）</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ennis L.M. Wu</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>
<script type="text/javascript" src="/lib/photo/photoswipe.min.js?v=5.1.4"></script>
<script type="text/javascript" src="/lib/photo/photoswipe-ui-default.min.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  


  
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":80,"height":160,"hOffset":-15},"mobile":{"show":false,"scale":0.2},"log":false});</script></body>
</html>
