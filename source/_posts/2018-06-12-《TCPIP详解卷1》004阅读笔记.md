---
title: '「TCP/IP详解 卷1」004 阅读笔记'
date: 2018-06-12 15:38:11
tags: [计算机网络,TCP,IP]
categories: 《TCP/IP详解 卷1》
---

RFC 826 [Plummer 1982] 是 ARP 规范描述文档。

ARP（地址解析协议）

RARP（逆地址解析协议）

ARP 为 IP 地址到对应硬件地址之间提供动态映射，因为是自动完成的。

RARP 被没有磁盘驱动器的系统使用，需要系统管理员手工设置。

ARP 发送一份称作 ARP 请求的以太网数据帧给以太网上的每个主机。称作广播。

点对点链路不使用 ARP。设置这些链路时，必须告知内核链路每一端的 IP 地址，而不需要硬件地址。

ARP 高效运行因为每个主机上都有一个 ARP 高速缓存

# ARP的分组格式

| 以太网目的地址 | 以太网源地址 | 帧类型        | 硬件类型       | 协议类型   | 硬件地址长度 | 协议地址长度 | op   | 发送端以太网地址 | 发送端IP地址 | 目的以太网地址 | 目的IP地址 |
| -------------- | ------------ | ------------- | -------------- | ---------- | ------------ | ------------ | ---- | ---------------- | ------------ | -------------- | ---------- |
| 6              | 6            | 2             | 2              | 2          | 1            | 1            | 2    | 6                | 4            | 6              | 4          |
| 全1            |              | 0x0806        | 1              | 0x0800     | 6 bytes      | 4 bytes      |      |                  |              |                |            |
| 广播地址       |              | ARP 请求或应答 | 表示以太网地址 | 表示 IP 地址 | MAC 地址长度  | IP 地址长度   |      |                  |              |                |            |

- 目的地址：全1的特殊地址是广播地址，电缆上的所有以太网接口都要接收广播的数据帧。

- 操作字段（OP）：ARP 请求（1）、ARP 应答（2）、RARP 请求（3）、RARP 应答（4），必须字段，因为 ARP 请求和应答的帧类型字段相同。

# ARP 高速缓存超时设置

- BSD 演变来的系统一般设置完整表项超时 20 分钟，不完整表项超时 3 分钟。

- 表项再次使用时，超时值重设为 20 分钟。

# ARP 代理

- 路由器相当于目的主机的代理，把分组从其他主机转发给它。

# 免费 ARP

- 是指发送 ARP 查找自己的 IP 地址。

- 两方面作用：

  1. 验证 IP 是否冲突，一个主机能够通过它来确定是否还有一个主机设置了相同的 IP 地址。
  
  2. 更换物理网卡，假设发送ARP的主机正好改变了物理地址，能够使用此方法通知网络中其他主机及时更新 ARP 缓存。

# ARP 命令

- arp -a 显示 ARP 高速缓存。

- arp -d 删除 ARP 高速缓存中某一项。

- arp -s 增加高速缓存中的内容，是永久性的，除非末尾加上关键字 temp。