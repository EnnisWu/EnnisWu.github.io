---
title: '「TCP/IP详解 卷1」003 阅读笔记'
date: 2018-06-02 15:07:17
tags: [计算机网络,TCP,IP,看不懂]
categories: 《TCP/IP详解 卷1》
---

IP 的正式规范文件：RFC 791

所有 TCP、UDP、ICMP 及 IGMP 数据都以 IP 数据报格式传输。

不可靠：不能保证 IP 数据报能够成功到达目的地。可靠性必须由上层提供。

无连接：IP 不维护后续数据报的状态信息。每个数据报的处理相互独立。IP 数据报可以不按发送顺序接收。

传输次序：网络字节序 /big endian（大端）字节序

# IP首部字段

| 字段名 | 长度 |   |
| ----- | ---- | ---- |
| 版本 | 4 位 | 4 |
| 首部长度 | 4 位 | 首部占 32 bit 字的数目，没有任何选项，值为 5，首部最长 60 字节 |
| 服务类型（TOS） | 8 位 | 3 bit 优先权子字段（已忽略），4 bit TOS 子字段，1 bit 未用位（置为 0） |
| 总长度 | 16 位 | 字节为单位，最长 65535 字节。**必要内容** |
| 位标识 | 16 位 | 唯一标识主机发送的每一份数据报 |
| 位标志 | 3 位 |  |
| 位片偏移 | 13 位 |  |
| 生存时间（TTL） | 8 位 | 经过的最多路由器数，初始值通常为 64 或 32，源主机设置。 |
| 协议 | 8 位 |  |
| 首部校验和 | 16 位 | 根据 IP 首部计算校验和码。 |
| 选项 |  | 可选，可变长。32 bit 为界限，不够时插入值为 0 的填充字节。 |

- 首部长度：从包头格式图看出，是以 32 bit 为一行的，一行包括若干字段。首部长度的数值是以 32 bit 为单位来描述的，比如四位全为 1，十六进制本来是 0X0F，也就是十进制的 15 但是，**这个字段的 1 不是数值 1，而是指 1 个单位即一个 32 bit。**所以如果该字段是 1111 的话。就是 15 * 32 bit = 60 Byte 了。

- 4 bit 的 TOS 代表：最小时延、最大吞吐量、最高可靠性、最小费用。

- 首部长度、总长度计算数据内容的起始位置和长度。

- TTL 为 0 时丢弃数据报，发送 ICMP 报文通知源主机。

- 首部校验和：如果校验和错误，丢弃数据报，但不生成差错报文，由上层发现并重传。

# IP路由选择

目的主机与源主机直接相连，或都在一个共享网络上，IP 数据报直接送到目的主机。

否则发往默认路由，由路由器转发。

## IP 层可以配置成路由器或主机

主机：不转发

路由器：转发

内含路由器的主机：不转发

## 收到数据报来自网络接口时（即非本地生成的数据报）

-  检查 IP 地址

  - 是本机 IP 地址之一或 IP 广播地址：发送到指定协议模块

    - IP 层设置为路由器：转发
    
    - 否则：丢弃

## 路由表

| 项 | 含义 |
| - | - |
| 目的 IP 地址 | 表中标志字段指定类型。完整的主机地址：非 0 主机号。网络地址：主机号为 0。 |
| 下一跳路由器 IP 地址 | 或者有直接连接的网络 IP 地址。 |
| 标志 | 一个指明目的 IP 地址类型，==**一个标志下一站路由器时真下一站路由器还是直接相连的接口。**看不懂这句== |
| 指定网络接口 |  |

IP 不知道目的的完整路径

## IP 路由选择主要功能

搜索路由表

1. 寻找与目的 IP 完全匹配（网络号和主机号）的条目

2. 寻找与目的网络号相匹配的条目（必须考虑子网掩码）

3. 寻找“默认”的条目

如果找到，报文发送指定的下一站路由器或直接相连的网络接口。

如果都未成功，则不能被传送，向应用返回错误

# 子网寻址

==看不懂图==

- 所有主机都要求支持子网寻址。

- IP 地址 = 网络号 + 子网号 + 主机号

- B 类 IP 地址 = 网络号（16 位）+ 子网号（8 位）+ 主机号（8 位）

- 子网对外部路由器来说隐藏了内部网络组织。

- 子网划分缩减了路由表的规模。

- 子网对于子网内部的路由器不透明。==不懂==

# 子网掩码

- 标识多少 bit 用于子网号，多少bit用于主机号。

- 掩码是 32 bit 的值，值为1留给网络号和子网号，值为 0 留给主机号。

- 给定 IP 地址和子网掩码后可以确定：

  1. 本子网上的主机。

  2. 本网络中其他子网中的主机。

  3. 其他网络上的主机。